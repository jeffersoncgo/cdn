<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JCGWEB CDN - Script Demonstrations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://jeffersoncgo.github.io/cdn/js/popupmessage.css" onerror="this.onerror=null;this.href=''; console.warn('popupmessage.css not found, using fallback styles.');">
    <link rel="stylesheet" href="https://jeffersoncgo.github.io/cdn/js/treelist.css" onerror="this.onerror=null;this.href=''; console.warn('treelist.css not found, using fallback styles.');">
    <!-- <link rel="stylesheet" href="https://jeffersoncgo.github.io/cdn/js/windows.css" onerror="this.onerror=null;this.href=''; console.warn('windows.css not found, using fallback styles.');"> -->
    <script>

    </script>

    <script src="https://jeffersoncgo.github.io/cdn/js/common.js"></script>
    <script src="https://jeffersoncgo.github.io/cdn/js/base.js"></script>
    <script src="https://jeffersoncgo.github.io/cdn/js/pid.js"></script>
    <script src="https://jeffersoncgo.github.io/cdn/js/controller.js"></script>
    <script src="https://jeffersoncgo.github.io/cdn/js/observer.js"></script>
    <script src="https://jeffersoncgo.github.io/cdn/js/object.js"></script>
    <script src="https://jeffersoncgo.github.io/cdn/js/popupmessage.js"></script>
    <script src="https://jeffersoncgo.github.io/cdn/js/treelist.js"></script>
    <script src="https://jeffersoncgo.github.io/cdn/js/TableSorter.js"></script>
    <script src="https://jeffersoncgo.github.io/cdn/js/windows.js"></script>
    <script src="https://jeffersoncgo.github.io/cdn/js/pagememory.js"></script>
    <script src="https://jeffersoncgo.github.io/cdn/js/themeControl.js"></script>

</head>
<body class="p-4 md:p-8">
    <header class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-800">JCGWEB CDN - Live Script Demonstrations</h1>
        <p class="text-lg text-gray-600 mt-2">Interactive examples of client-side JavaScript utilities.</p>
    </header>

    <main>
        <section class="script-section" id="common-demo">
            <h2>🔧 common.js</h2>
            <p>Provides common utility functions. Below are some outputs from its static methods.</p>
            <div class="demo-area">
                <h3>Script & URL Info:</h3>
                <p><strong>CurrentScriptUrl (of common.js):</strong> <span id="common-script-url">Loading...</span></p>
                <p><strong>CurrentScriptName (of common.js):</strong> <span id="common-script-name">Loading...</span></p>
                <p><strong>Current Page URL:</strong> <span id="common-page-url">Loading...</span></p>
                <p><strong>Current Page Path:</strong> <span id="common-page-path">Loading...</span></p>

                <h3>makeObjbyPath:</h3>
                <button onclick="demoMakeObjByPath()">Create Nested Object</button>
                <p>Result: <span id="common-makeobj-result"></span></p>

                <h3>safeWindowsFileName:</h3>
                <input type="text" id="common-filename-input" placeholder="Enter a filename: e.g., file:name?.txt">
                <button onclick="demoSafeFilename()">Sanitize Filename</button>
                <p>Safe name: <span id="common-safe-filename"></span></p>

                <h3>AddScript/AddStyle/AddMeta:</h3>
                <p>These functions dynamically add elements to `<head>`. Check your browser's inspector.</p>
                <button onclick="utils.AddMeta('demo-meta', 'This meta tag was added by common.js')">Add Demo Meta Tag</button>
            </div>
        </section>

        <section class="script-section" id="observer-demo">
            <h2>🧿 observer.js</h2>
            <p>Monitors a DOM element for changes and user interaction events.</p>
            <div class="demo-area">
                <div id="observedElement" class="p-4 border border-dashed border-blue-500 rounded h-32" contenteditable="true">
                    Click, type, or change attributes (via inspector) in this blue dashed box.
                </div>
                <button onclick="observerDemoAddAttribute()">Add Attribute to Box</button>
                <button onclick="observerDemoAddChild()">Add Child to Box</button>
                <h3>Log:</h3>
                <div id="observer-log" class="output-log">Observer log will appear here...</div>
            </div>
        </section>

        <section class="script-section" id="controller-demo">
            <h2>🎮 controller.js</h2>
            <p>Manages asynchronous function execution, allowing aborting previous calls.</p>
            <div class="demo-area">
                <button onclick="demoControlledFetch('fast_query')">Run Fast Query (500ms)</button>
                <button onclick="demoControlledFetch('slow_query')">Run Slow Query (2s), then Fast</button>
                <p>Check console and log below for messages.</p>
                <h3>Log:</h3>
                <div id="controller-log" class="output-log">Controller log...</div>
            </div>
        </section>

        <section class="script-section" id="base-demo">
            <h2>🔩 base.js</h2>
            <p>Initializes `JCGWeb` namespace and provides foundational DOM utilities.</p>
            <div class="demo-area">
                <h3>Mouse Coordinates (JCGWeb.Variables.Mouse):</h3>
                <p>Move your mouse over the page.</p>
                <p>X: <span id="base-mouse-x">N/A</span>, Y: <span id="base-mouse-y">N/A</span></p>

                <h3>CreateElementFromHTML:</h3>
                <button onclick="demoCreateElement()">Create & Append Element</button>
                <div id="base-created-elements-container"></div>

                <h3>FindComponentFromEvent:</h3>
                <div id="base-find-parent" class="p-2 bg-yellow-200 rounded">
                    <button id="base-find-child-btn" class="bg-yellow-500 hover:bg-yellow-600">Click me to find my parent div</button>
                </div>

                <h3>getUniqueSelector:</h3>
                <p>Click the button below, then click any element on the page. Its unique selector will be logged to console and shown here.</p>
                <button onclick="JCGWeb.Functions.getUniqueSelectorOnClick()">Activate Selector Click</button>
                <p>Clicked Selector: <span id="base-unique-selector-output">(waiting for click after activation)</span></p>

                <h3>MakeSafePos:</h3>
                <div id="base-safe-pos-parent" class="relative w-64 h-32 bg-gray-300 my-2">
                    <div id="base-safe-pos-child" class="absolute w-16 h-16 bg-red-500">Child</div>
                </div>
                <button onclick="demoMakeSafePos()">Position Child Safely (Attempt 0,0)</button>
                <button onclick="demoMakeSafePos(200, 100)">Position Child Safely (Attempt 200,100 - off bounds)</button>
            </div>
        </section>

        <section class="script-section" id="object-demo">
            <h2>📦 object.js</h2>
            <p>Utility functions for working with JavaScript objects.</p>
            <div class="demo-area">
                <h3>GetValueFromPath:</h3>
                <p>Object: <code>{ user: { name: 'Alice', details: { age: 30 } } }</code>, Path: <code>user.details.age</code></p>
                <p>Result: <span id="object-getvalue-result"></span></p>

                <h3>MakeObjFromPath:</h3>
                <p>Path: <code>app.settings.theme</code>, Value: <code>dark</code></p>
                <p>Resulting Object: <span id="object-makeobj-result"></span></p>

                <h3>cleanObject:</h3>
                <p>Input: <code>{ a: 1, b: null, c: '', d: { e: undefined, f: [] }, g: [1,2], h: {} }</code></p>
                <p>Cleaned: <span id="object-clean-result"></span></p>

                <h3>mergeObjects:</h3>
                <p>Obj1: <code>{ a:1, b:{x:10} }</code>, Obj2: <code>{ b:{y:20}, c:3 }</code></p>
                <p>Merged: <span id="object-merge-result"></span></p>
            </div>
        </section>

        <section class="script-section" id="popupmessage-demo">
            <h2>💬 popupmessage.js</h2>
            <p>Displays temporary, dismissible popup messages (toasts/notifications).</p>
            <div class="demo-area">
                <button onclick="PopuMessageManager.addMessage('This is a simple info message!', 'Info', 3000)">Show Info Message</button>
                <button onclick="PopuMessageManager.addMessage('Something went well!', 'Success', 5000, null, ()=>console.log('Success closed!'))">Show Success with Close Callback</button>
                <p>Messages will appear at the top-right of the screen.</p>
            </div>
        </section>

        <section class="script-section" id="treelist-demo">
            <h2>🌳 treelist.js</h2>
            <p>Creates a collapsible, tree-like list from a JSON object or array.</p>
            <div class="demo-area">
                <button onclick="TreeListManager.OpenAll()">Open All</button>
                <button onclick="TreeListManager.CloseAll()">Close All</button>
                <div id="treeContainer" class="mt-2 border p-2 rounded bg-white">Tree will be rendered here...</div>
            </div>
        </section>

        <section class="script-section" id="tablesorter-demo">
            <h2>📊 TableSorter.js</h2>
            <p>Adds client-side sorting functionality to HTML tables. Click on table headers to sort.</p>
            <div class="demo-area">
                <table id="demoSortableTable" class="w-full">
                    <thead>
                        <tr>
                            <th sorttitle="Name">Name</th>
                            <th sorttitle="Age" data-sorttype="Number">Age</th>
                            <th sorttitle="JoinDate" data-sorttype="Date">Join Date</th>
                            <th _sortignore>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Charlie Brown</td><td>8</td><td>2022-03-15</td><td>View</td></tr>
                        <tr><td>Alice Wonderland</td><td>30</td><td>2021-07-22</td><td>View</td></tr>
                        <tr><td>Bob The Builder</td><td>45</td><td>2020-01-10</td><td>View</td></tr>
                        <tr><td>Eve Harrington</td><td>28</td><td>2023-11-05</td><td>View</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section class="script-section" id="windows-demo">
            <h2>🖼️ windows.js</h2>
            <p>System for creating and managing draggable, resizable windows or dialogs.</p>
            <div class="demo-area">
                <button onclick="demoCreateWindow()">Create Basic Window</button>
                <button onclick="demoCreatePopup()">Create Confirmation Popup</button>
                <p>Windows will appear on the page. Ensure no ad-blockers are interfering with popup creation.</p>
            </div>
        </section>

        <section class="script-section" id="pagememory-demo">
            <h2>🧠 pagememory.js</h2>
            <p>Persists and restores the state of specified DOM elements across page loads using localStorage.</p>
            <div class="demo-area">
                <p>Enter some values in the fields below, then reload the page. The values should persist.</p>
                <div>
                    <label for="pm-text">Text Input:</label>
                    <input type="text" id="pm-text" save placeholder="Type something...">
                </div>
                <div>
                    <label for="pm-check">Checkbox:</label>
                    <input type="checkbox" id="pm-check" save> Remember
                </div>
                <div>
                    <label for="pm-select">Select:</label>
                    <select id="pm-select" save>
                        <option value="">--Choose--</option>
                        <option value="option1">Option 1</option>
                        <option value="option2">Option 2</option>
                    </select>
                </div>
                <details id="pm-details" save class="mt-2">
                    <summary class="cursor-pointer">Collapsible Section (state saved)</summary>
                    <p class="p-2 bg-gray-100">This section's open/closed state will be remembered.</p>
                </details>
                <div class="mt-2">
                     <label for="pm-custom">Custom Trigger Input:</label>
                    <input type="text" id="pm-custom" save customTrigger="myCustomTriggerHandler" placeholder="Restored value triggers function">
                    <p class="text-sm text-gray-500">After this field is restored, 'myCustomTriggerHandler' will be called.</p>
                </div>
                <button onclick="pageMemoryInstance && pageMemoryInstance.clearSavedMemory(); alert('PageMemory localStorage cleared for this page. Reload to see effect.');">Clear Saved Memory for this Page</button>
            </div>
        </section>

        <section class="script-section" id="themecontrol-demo">
            <h2>🎨 themeControl.js</h2>
            <p>Provides a UI for dynamically changing website themes. A brush icon button should appear at the bottom-right. Click it to open the theme control panel. The panel itself will be styled by `themeControl.css` (if loaded) or fallback styles.</p>
            <div class="demo-area">
                <p class="text-lg font-semibold text-blue-600">This is a styled paragraph.</p>
                <div class="p-4 bg-green-500 text-white rounded mt-2">
                    This is a styled div. Its colors should be affected by the theme controller.
                </div>
                <button class="mt-2 bg-purple-500 hover:bg-purple-700">Styled Button</button>
            </div>
        </section>

    </main>

    <footer class="text-center mt-12 py-4 border-t border-gray-300">
        <p class="text-gray-600">&copy; <span id="currentYear"></span> JCGWEB CDN Examples</p>
    </footer>

    <script>
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        // --- common.js Demo ---
        if (typeof utils !== 'undefined') {
            document.getElementById('common-script-url').textContent = utils.CurrentScriptUrl || 'common.js not fully loaded';
            document.getElementById('common-script-name').textContent = utils.CurrentScriptName || 'common.js not fully loaded';
            document.getElementById('common-page-url').textContent = utils.CurrentUrl;
            document.getElementById('common-page-path').textContent = utils.CurrentUrlPath;
        } else {
            console.error("common.js (utils) not loaded.");
            ['common-script-url', 'common-script-name', 'common-page-url', 'common-page-path'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.textContent = "Error: common.js not loaded";
            });
        }

        function demoMakeObjByPath() {
            let obj = {};
            utils.makeObjbyPath(obj, 'test.deep.property', 'Hello from common.js!');
            document.getElementById('common-makeobj-result').textContent = JSON.stringify(obj);
        }
        function demoSafeFilename() {
            const input = document.getElementById('common-filename-input').value;
            document.getElementById('common-safe-filename').textContent = utils.safeWindowsFileName(input);
        }

        // --- observer.js Demo ---
        let observerInstance;
        if (typeof Observer !== 'undefined') {
            const observedEl = document.getElementById('observedElement');
            const observerLog = document.getElementById('observer-log');
            observerInstance = new Observer(observedEl);
            observerInstance.AddCallBack((mutationsList, obs) => {
                if (mutationsList && mutationsList.length > 0 && !(mutationsList[0] instanceof Event)) { // It's a mutation
                     mutationsList.forEach(mutation => {
                        let logMsg = `Mutation: ${mutation.type}. `;
                        if (mutation.type === 'attributes') logMsg += `Attr: ${mutation.attributeName}. Old: ${mutation.oldValue}`;
                        if (mutation.type === 'childList') logMsg += `${mutation.addedNodes.length} added, ${mutation.removedNodes.length} removed.`;
                        if (mutation.type === 'characterData') logMsg += `New data: "${observedEl.textContent.substring(0,20)}..."`;
                        observerLog.innerHTML = logMsg + '<br>' + observerLog.innerHTML;
                    });
                }
            });
             observerInstance.AddCallBack((event) => { // For DOM events
                if (event instanceof Event) {
                    observerLog.innerHTML = `Event: ${event.type} on target ${event.target.id || event.target.tagName}<br>` + observerLog.innerHTML;
                }
            });
            observerInstance.Start();
        } else {
            console.error("Observer class not loaded.");
        }
        function observerDemoAddAttribute() {
            const el = document.getElementById('observedElement');
            el.setAttribute('data-timestamp', Date.now());
        }
        function observerDemoAddChild() {
            const el = document.getElementById('observedElement');
            const newChild = document.createElement('p');
            newChild.textContent = "New child added at " + new Date().toLocaleTimeString();
            el.appendChild(newChild);
        }


        // --- controller.js Demo ---
        let controllerLogOutput;
        if (typeof Controller !== 'undefined') {
            controllerLogOutput = document.getElementById('controller-log');
            async function demoAsyncFunc(query, signal) {
                const delay = query === 'fast_query' ? 500 : 2000;
                controllerLogOutput.innerHTML = `Starting fetch for: ${query} (will take ${delay}ms)<br>` + controllerLogOutput.innerHTML;
                await new Promise(resolve => setTimeout(resolve, delay));
                if (signal.aborted) {
                    controllerLogOutput.innerHTML = `Fetch ABORTED for: ${query}<br>` + controllerLogOutput.innerHTML;
                    throw new DOMException('Aborted by Controller', 'AbortError');
                }
                return `Data for ${query}`;
            }
            const demoController = new Controller(
                demoAsyncFunc,
                (result, query) => { controllerLogOutput.innerHTML = `SUCCESS: ${result} (Original: ${query})<br>` + controllerLogOutput.innerHTML; },
                (error) => { controllerLogOutput.innerHTML = `ERROR: ${error.message}<br>` + controllerLogOutput.innerHTML; },
                (query) => { controllerLogOutput.innerHTML = `ABORTED by new call (Original: ${query})<br>` + controllerLogOutput.innerHTML; },
                true // AbortPreviousOnExecute = true
            );
            window.demoControlledFetch = (query) => {
                demoController.exec(query);
                if (query === 'slow_query') {
                    setTimeout(() => demoController.exec('fast_query_interrupts_slow'), 700);
                }
            };
        } else {
            console.error("Controller class not loaded.");
        }


        // --- base.js Demo ---
        if (typeof JCGWeb !== 'undefined' && JCGWeb.Variables && JCGWeb.Variables.Mouse) {
            const mouseXEl = document.getElementById('base-mouse-x');
            const mouseYEl = document.getElementById('base-mouse-y');
            // JCGWeb.Observer (from base.js) should be updating these
            setInterval(() => {
                mouseXEl.textContent = JCGWeb.Variables.Mouse.X;
                mouseYEl.textContent = JCGWeb.Variables.Mouse.Y;
            }, 100);

            window.demoCreateElement = () => {
                const [newP] = JCGWeb.Functions.CreateElementFromHTML('<p class="text-green-600">Hello from CreateElementFromHTML!</p>');
                document.getElementById('base-created-elements-container').appendChild(newP);
            };

            document.getElementById('base-find-child-btn').addEventListener('click', (event) => {
                const parentDiv = JCGWeb.Functions.FindComponentFromEvent(event, 'id', 'base-find-parent');
                if (parentDiv) {
                    alert('Parent with ID "base-find-parent" found!');
                    parentDiv.style.border = '2px solid red';
                    setTimeout(() => parentDiv.style.border = '', 2000);
                } else {
                    alert('Parent not found.');
                }
            });
            // For getUniqueSelectorOnClick
            const uniqueSelectorOutput = document.getElementById('base-unique-selector-output');
            const htmlEl = document.querySelector('html');
            const originalGetAttribute = htmlEl.getAttribute; // Store original
            htmlEl.setAttribute = function(name, value) { // Monkey-patch to update our span
                 HTMLHtmlElement.prototype.setAttribute.apply(this, arguments);
                if (name === 'data-clicked-selector') {
                    uniqueSelectorOutput.textContent = value;
                }
            };


            const safePosChild = document.getElementById('base-safe-pos-child');
            const safePosParent = document.getElementById('base-safe-pos-parent');
            window.demoMakeSafePos = (left = 0, top = 0) => {
                const safePos = JCGWeb.Functions.MakeSafePos(
                    parseFloat(getComputedStyle(safePosChild).width),
                    parseFloat(getComputedStyle(safePosChild).height),
                    left,
                    top,
                    safePosParent
                );
                safePosChild.style.left = safePos.left + 'px';
                safePosChild.style.top = safePos.top + 'px';
                console.log('MakeSafePos applied:', safePos);
            };

        } else {
            console.error("JCGWeb (base.js) not fully loaded.");
        }

        // --- object.js Demo ---
        if (typeof GetValueFromPath !== 'undefined') {
            const sampleObj = { user: { name: 'Alice', details: { age: 30 } } };
            document.getElementById('object-getvalue-result').textContent = GetValueFromPath('user.details.age', sampleObj);

            let objForMake = {};
            MakeObjFromPath('app.settings.theme', 'dark', objForMake);
            document.getElementById('object-makeobj-result').textContent = JSON.stringify(objForMake);

            const dirtyObj = { a: 1, b: null, c: '', d: { e: undefined, f: [] }, g: [1,2], h: {} };
            document.getElementById('object-clean-result').textContent = JSON.stringify(cleanObject(JSON.parse(JSON.stringify(dirtyObj))));


            let objA = { a:1, b:{x:10} };
            let objB = { b:{y:20}, c:3 };
            document.getElementById('object-merge-result').textContent = JSON.stringify(mergeObjects(objA, objB));
        } else {
            console.error("object.js functions not loaded.");
        }


        // --- treelist.js Demo ---
        if (typeof TreeListManager !== 'undefined') {
            const treeJsonData = {
                "Project Files": {
                    "src": {
                        "components": {
                            "Button.js": "Button component code",
                            "Card.js": "Card component code"
                        },
                        "App.js": "Main application file",
                        "index.js": "Entry point"
                    },
                    "public": {
                        "index.html": "Main HTML",
                        "favicon.ico": "Favicon"
                    },
                    "package.json": "Project dependencies"
                },
                "Notes/ideas.txt": "Some quick notes here"
            };
            TreeListManager.TreeHTML(treeJsonData).then(html => {
                document.getElementById('treeContainer').innerHTML = html;
            });
        } else {
            console.error("TreeListManager not loaded.");
        }

        // --- TableSorter.js Demo ---
        if (typeof TableSorter !== 'undefined' && typeof Sorters !== 'undefined') {
            const sortConfig = {
                'Name': Sorters.Default,
                'Age': Sorters.Number,
                'JoinDate': Sorters.Date,
            };
            new TableSorter('demoSortableTable', sortConfig, false);
        } else {
            console.error("TableSorter or Sorters not loaded.");
        }

        // --- windows.js Demo ---
        if (typeof JCGWeb !== 'undefined' && JCGWeb.Windows) {
            window.demoCreateWindow = () => {
                const win = JCGWeb.Windows.AddWindow();
                win.title = "Demo Window";
                win.icon = "<span>📄</span>"; // Simple icon
                const content = document.createElement('p');
                content.innerHTML = "This is a window created by <strong>windows.js</strong>. You can drag it by its title bar.";
                const input = document.createElement('input');
                input.type = 'text';
                input.placeholder = 'Type here...';
                win._elements = [content, input];
                win._buttons = ['info', 'minimize', 'maximize', 'close']; // Use default buttons
                win.Create_Window();
                win.Show(undefined, undefined, '400px', '200px', true); // Show centered
            };

            window.demoCreatePopup = () => {
                JCGWeb.Windows.CreatePopup(
                    "Confirmation",
                    "Are you sure you want to perform this action?",
                    "<span>❓</span>", // Icon
                    true, // Close button
                    "Yes, Proceed",
                    (e) => { alert('Proceed clicked!'); JCGWeb.Windows.CloseWindowByEvent(e); },
                    "No, Cancel",
                    (e) => { alert('Cancel clicked!'); JCGWeb.Windows.CloseWindowByEvent(e); }
                );
            };
        } else {
            console.error("JCGWeb.Windows not loaded.");
        }

        // --- pagememory.js Demo ---
        let pageMemoryInstance;
        if (typeof pageMemory !== 'undefined') {
            pageMemoryInstance = new pageMemory(); // Initialize
            window.myCustomTriggerHandler = function(element) {
                console.log(`Custom trigger for ${element.id}! Its value is: ${element.value}`);
                alert(`PageMemory custom trigger fired for element ID: ${element.id}\nValue: ${element.value}`);
                element.style.border = "2px solid green";
                setTimeout(() => element.style.border = "", 2000);
            };
        } else {
            console.error("pageMemory not loaded.");
        }

        // themeControl.js initializes itself by adding a button.
        // No specific demo function needed here, just ensure the page has styled elements.

    </script>
</body>
</html>
